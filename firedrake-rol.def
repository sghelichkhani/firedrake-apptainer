Bootstrap: localimage
From: containers/image-firedrake-koki.sif 

%post
    dnf install -y python39 procps-ng gcc gcc-gfortran git libnl3-devel numactl-devel boost-devel
    source /opt/intel/oneapi/setvars.sh "" > /dev/null
    source /opt/firedrake/bin/activate
    pip install git+https://github.com/sghelichkhani/pyrol.git@trilinos-cmake
	 pip install scipy

%files
    files/__init__.py /opt/firedrake/src/pyadjoint/pyadjoint/__init__.py
    files/solving_modified.py /opt/firedrake/src/firedrake/firedrake/solving.py

%runscript
    source /opt/intel/oneapi/setvars.sh "" > /dev/null
    source /opt/firedrake/bin/activate
    export PYOP2_CACHE_DIR=${PBS_JOBFS:-${TMPDIR:-/tmp}}/pyop2
    export FIREDRAKE_TSFC_KERNEL_CACHE_DIR=${PBS_JOBFS:-${TMPDIR:-/tmp}}/tsfc
    export LD_LIBRARY_PATH=/opt/ompi/lib/GNU:$LD_LIBRARY_PATH
    export PATH="/home/sia/Local/cmake/usr/local/bin/":${PATH}
    exec $@

